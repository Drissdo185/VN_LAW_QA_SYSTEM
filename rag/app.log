[2025-03-07 22:40:44,195] INFO [__main__] Starting application
[2025-03-07 22:40:44,197] INFO [__main__] Selected LLM provider: openai
[2025-03-07 22:40:44,198] INFO [__main__] Initializing components with LLM provider: openai
[2025-03-07 22:40:44,198] INFO [retrieval.vector_store] Initializing connection to Weaviate at https://eypxka08rk6gbnyt57idzq.c0.us-west3.gcp.weaviate.cloud
[2025-03-07 22:40:44,198] INFO [retrieval.vector_store] Using collection: ND168
[2025-03-07 22:40:44,199] INFO [retrieval.vector_store] Creating new Weaviate client connection
[2025-03-07 22:40:44,829] INFO [httpx] HTTP Request: GET https://eypxka08rk6gbnyt57idzq.c0.us-west3.gcp.weaviate.cloud/v1/meta "HTTP/1.1 200 OK"
[2025-03-07 22:40:45,137] INFO [httpx] HTTP Request: GET https://eypxka08rk6gbnyt57idzq.c0.us-west3.gcp.weaviate.cloud/v1/schema/ND168 "HTTP/1.1 200 OK"
[2025-03-07 22:40:45,139] INFO [retrieval.vector_store] Collection exists: True
[2025-03-07 22:40:45,140] INFO [retrieval.vector_store] Successfully connected to Weaviate
[2025-03-07 22:40:45,140] INFO [retrieval.vector_store] Loading embedding model: dangvantuan/vietnamese-document-embedding
[2025-03-07 22:40:45,143] INFO [sentence_transformers.SentenceTransformer] Load pretrained SentenceTransformer: dangvantuan/vietnamese-document-embedding
[2025-03-07 22:40:51,278] INFO [sentence_transformers.SentenceTransformer] 2 prompts are loaded, with the keys: ['query', 'text']
[2025-03-07 22:40:51,785] INFO [httpx] HTTP Request: GET https://eypxka08rk6gbnyt57idzq.c0.us-west3.gcp.weaviate.cloud/v1/schema/ND168 "HTTP/1.1 200 OK"
[2025-03-07 22:40:51,797] INFO [retrieval.vector_store] Successfully initialized vector store and index for collection ND168
[2025-03-07 22:40:51,798] INFO [retrieval.retriever] Retriever setup complete with similarity_top_k=5
[2025-03-07 22:40:53,953] INFO [retrieval.search_pipline] Initialized CrossEncoder with model: dangvantuan/vietnamese-document-embedding
[2025-03-07 22:40:53,953] INFO [retrieval.search_pipline] Initialized SearchPipeline
[2025-03-07 22:40:53,953] INFO [reasoning.auto_rag] Setting up OpenAI LLM with model: gpt-4o-mini
[2025-03-07 22:40:53,953] INFO [reasoning.auto_rag] Initialized Traffic AutoRAG with LLM provider: LLMProvider.OPENAI
[2025-03-07 22:40:53,953] INFO [reasoning.auto_rag] Using basic DocumentRetriever for document retrieval
[2025-03-07 22:40:53,953] INFO [__main__] Initializing web search integration
[2025-03-07 22:40:53,954] INFO [web_handle.web_search] Initialized WebSearchIntegrator
[2025-03-07 22:40:53,954] INFO [__main__] Components initialized successfully
[2025-03-07 22:40:53,954] INFO [__main__] Processing new question: Mức phạt nồng độ cồn 2025 đối với xe máy
[2025-03-07 22:40:53,956] INFO [__main__] Processing question: Mức phạt nồng độ cồn 2025 đối với xe máy
[2025-03-07 22:40:53,956] INFO [reasoning.auto_rag] Question validated as traffic-related via keyword: phạt
[2025-03-07 22:40:53,956] INFO [reasoning.auto_rag] Iteration 1: Retrieving documents for query: Mức phạt nồng độ cồn 2025 đối với xe máy
[2025-03-07 22:40:53,956] INFO [reasoning.auto_rag] Tokenized query: mức phạt nồng_độ cồn 2025 đối_với xe_máy
[2025-03-07 22:40:53,956] INFO [reasoning.auto_rag] Using basic DocumentRetriever for retrieval
[2025-03-07 22:40:53,957] INFO [retrieval.retriever] Original query: 'Mức phạt nồng độ cồn 2025 đối với xe máy'
[2025-03-07 22:40:53,957] INFO [retrieval.retriever] Tokenized query: 'mức phạt nồng_độ cồn 2025 đối_với xe_máy'
[2025-03-07 22:40:54,787] INFO [retrieval.retriever] Retrieved 5 documents for query
[2025-03-07 22:40:54,788] INFO [retrieval.retriever] Top result score: 0.9107164144515991
[2025-03-07 22:40:54,788] INFO [retrieval.retriever] Score range: 0.6929110288619995 to 0.9107164144515991
[2025-03-07 22:40:54,789] INFO [reasoning.auto_rag] DocumentRetriever returned 5 documents
[2025-03-07 22:40:54,789] INFO [reasoning.auto_rag] Retrieved document details:
[2025-03-07 22:40:54,790] INFO [reasoning.auto_rag] Doc 1 score: 0.9107164144515991
[2025-03-07 22:40:54,790] INFO [reasoning.auto_rag] Doc 1 metadata: {'category': 'ô tô', 'fine_amount': 'Tước quyền sử dụng giấy phép lái xe từ 22 tháng đến 24 tháng', 'violation_type': 'nồng_độ_cồn', 'original_text': 'Loại phương tiện: ô tô\nMức phạt: Tước quyền sử dụng giấy phép lái xe từ 22 tháng đến 24 tháng\nNội dung vi phạm: Không chấp hành yêu cầu kiểm tra về chất ma túy hoặc chất kích thích khác mà pháp luật cấm sử dụng'}
[2025-03-07 22:40:54,790] INFO [reasoning.auto_rag] Doc 2 score: 0.8166821002960205
[2025-03-07 22:40:54,791] INFO [reasoning.auto_rag] Doc 2 metadata: {'category': 'ô tô', 'fine_amount': 'Phạt tiền từ 30.000.000 đồng đến 40.000.000 đồng', 'violation_type': 'nồng_độ_cồn', 'original_text': 'Loại phương tiện: ô tô\nMức phạt: Phạt tiền từ 30.000.000 đồng đến 40.000.000 đồng\nNội dung vi phạm: Không chấp hành yêu cầu kiểm tra về chất ma túy hoặc chất kích thích khác mà pháp luật cấm sử dụng của người thi hành công vụ'}
[2025-03-07 22:40:54,791] INFO [reasoning.auto_rag] Doc 3 score: 0.7691859006881714
[2025-03-07 22:40:54,791] INFO [reasoning.auto_rag] Doc 3 metadata: {'category': 'ô tô', 'fine_amount': 'Phạt tiền từ 6.000.000 đồng đến 8.000.000 đồng', 'violation_type': 'nồng_độ_cồn', 'original_text': 'Loại phương tiện: ô tô\nMức phạt: Phạt tiền từ 6.000.000 đồng đến 8.000.000 đồng\nNội dung vi phạm: Điều khiển xe trên đường mà trong máu hoặc hơi thở có nồng độ cồn nhưng chưa vượt quá 50 miligam/100 mililít máu hoặc chưa vượt quá 0,25 miligam/1 lít khí thở'}
[2025-03-07 22:40:54,792] INFO [reasoning.auto_rag] Context length: 1285 characters
[2025-03-07 22:40:54,795] INFO [reasoning.auto_rag] Input tokens: 639
[2025-03-07 22:40:58,244] INFO [httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-03-07 22:40:58,247] INFO [reasoning.auto_rag] Output tokens: 178
[2025-03-07 22:40:58,248] INFO [reasoning.auto_rag] Decision: Cần thêm thông tin
[2025-03-07 22:40:58,248] INFO [reasoning.auto_rag] Need more information, next query: Tìm kiếm thông tin về mức phạt nồng độ cồn đối với xe máy trong năm 2025.
[2025-03-07 22:40:58,248] INFO [reasoning.auto_rag] Iteration 2: Retrieving documents for query: Tìm kiếm thông tin về mức phạt nồng độ cồn đối với xe máy trong năm 2025.
[2025-03-07 22:40:58,248] INFO [reasoning.auto_rag] Tokenized query: tìm_kiếm thông_tin về mức phạt nồng_độ cồn đối_với xe_máy trong năm 2025 .
[2025-03-07 22:40:58,248] INFO [reasoning.auto_rag] Using basic DocumentRetriever for retrieval
[2025-03-07 22:40:58,249] INFO [retrieval.retriever] Original query: 'Tìm kiếm thông tin về mức phạt nồng độ cồn đối với xe máy trong năm 2025.'
[2025-03-07 22:40:58,249] INFO [retrieval.retriever] Tokenized query: 'tìm_kiếm thông_tin về mức phạt nồng_độ cồn đối_với xe_máy trong năm 2025 .'
[2025-03-07 22:40:58,854] INFO [retrieval.retriever] Retrieved 5 documents for query
[2025-03-07 22:40:58,854] INFO [retrieval.retriever] Top result score: 0.8750579357147217
[2025-03-07 22:40:58,855] INFO [retrieval.retriever] Score range: 0.6940207481384277 to 0.8750579357147217
[2025-03-07 22:40:58,855] INFO [reasoning.auto_rag] DocumentRetriever returned 5 documents
[2025-03-07 22:40:58,855] INFO [reasoning.auto_rag] Retrieved document details:
[2025-03-07 22:40:58,855] INFO [reasoning.auto_rag] Doc 1 score: 0.8750579357147217
[2025-03-07 22:40:58,855] INFO [reasoning.auto_rag] Doc 1 metadata: {'category': 'ô tô', 'fine_amount': 'Tước quyền sử dụng giấy phép lái xe từ 22 tháng đến 24 tháng', 'violation_type': 'nồng_độ_cồn', 'original_text': 'Loại phương tiện: ô tô\nMức phạt: Tước quyền sử dụng giấy phép lái xe từ 22 tháng đến 24 tháng\nNội dung vi phạm: Không chấp hành yêu cầu kiểm tra về chất ma túy hoặc chất kích thích khác mà pháp luật cấm sử dụng'}
[2025-03-07 22:40:58,855] INFO [reasoning.auto_rag] Doc 2 score: 0.80940842628479
[2025-03-07 22:40:58,855] INFO [reasoning.auto_rag] Doc 2 metadata: {'category': 'ô tô', 'fine_amount': 'Phạt tiền từ 30.000.000 đồng đến 40.000.000 đồng', 'violation_type': 'nồng_độ_cồn', 'original_text': 'Loại phương tiện: ô tô\nMức phạt: Phạt tiền từ 30.000.000 đồng đến 40.000.000 đồng\nNội dung vi phạm: Không chấp hành yêu cầu kiểm tra về chất ma túy hoặc chất kích thích khác mà pháp luật cấm sử dụng của người thi hành công vụ'}
[2025-03-07 22:40:58,855] INFO [reasoning.auto_rag] Doc 3 score: 0.7671982049942017
[2025-03-07 22:40:58,855] INFO [reasoning.auto_rag] Doc 3 metadata: {'category': 'ô tô', 'fine_amount': 'Phạt tiền từ 6.000.000 đồng đến 8.000.000 đồng', 'violation_type': 'nồng_độ_cồn', 'original_text': 'Loại phương tiện: ô tô\nMức phạt: Phạt tiền từ 6.000.000 đồng đến 8.000.000 đồng\nNội dung vi phạm: Điều khiển xe trên đường mà trong máu hoặc hơi thở có nồng độ cồn nhưng chưa vượt quá 50 miligam/100 mililít máu hoặc chưa vượt quá 0,25 miligam/1 lít khí thở'}
[2025-03-07 22:40:58,856] INFO [reasoning.auto_rag] Context length: 2479 characters
[2025-03-07 22:40:58,857] INFO [reasoning.auto_rag] Input tokens: 1046
[2025-03-07 22:41:02,135] INFO [httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-03-07 22:41:02,139] INFO [reasoning.auto_rag] Output tokens: 187
[2025-03-07 22:41:02,140] INFO [reasoning.auto_rag] Decision: Cần thêm thông tin
[2025-03-07 22:41:02,140] INFO [reasoning.auto_rag] Need more information, next query: Tìm kiếm thông tin về mức phạt nồng độ cồn đối với xe máy trong năm 2025.
[2025-03-07 22:41:02,140] WARNING [reasoning.auto_rag] Exiting loop without sufficient information
[2025-03-07 22:41:02,141] INFO [utils] Function process_question completed in 8.19 seconds
[2025-03-07 22:41:02,142] INFO [__main__] Question processed in 8.19 seconds
[2025-03-07 22:41:02,143] INFO [__main__] Needs web search: True
[2025-03-07 22:41:02,144] INFO [__main__] Web search prompt triggered
[2025-03-07 22:41:02,145] INFO [__main__] Displaying results
[2025-03-07 22:41:02,146] INFO [__main__] Response generated using: OpenAI GPT-4o mini
[2025-03-07 22:41:02,152] INFO [__main__] Cleaning up components
[2025-03-07 22:41:02,153] INFO [retrieval.vector_store] Closing Weaviate client connection
[2025-03-07 22:41:02,159] INFO [retrieval.vector_store] Weaviate client connection closed
[2025-03-07 22:41:02,160] INFO [__main__] Displaying web search prompt
